<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: switches Pages: 1 -->
<svg width="842pt" height="720pt"
 viewBox="0.00 0.00 841.57 720.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(.4255 .4255) rotate(0) translate(36 1656)">
<title>switches</title>
<polygon fill="#ffffff" stroke="transparent" points="-36,36 -36,-1656 1941.6934,-1656 1941.6934,36 -36,36"/>
<g id="clust1" class="cluster">
<title>cluster_b</title>
<polygon fill="none" stroke="#c0c0c0" points="434.876,-1024 434.876,-1612 1099.876,-1612 1099.876,-1024 434.876,-1024"/>
<text text-anchor="middle" x="767.376" y="-1588.8" font-family="Times,serif" font-size="24.00" fill="#000000">Forms namespace</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_d</title>
<polygon fill="none" stroke="#ffffff" points="8,-8 8,-936 1897.6934,-936 1897.6934,-8 8,-8"/>
</g>
<g id="clust3" class="cluster">
<title>cluster_a</title>
<polygon fill="none" stroke="#c0c0c0" points="434.876,-16 434.876,-928 738.876,-928 738.876,-16 434.876,-16"/>
<text text-anchor="middle" x="586.876" y="-904.8" font-family="Times,serif" font-size="24.00" fill="#000000">Publisher namespace</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_c</title>
<polygon fill="none" stroke="#c0c0c0" points="1156.876,-520 1156.876,-928 1889.6934,-928 1889.6934,-520 1156.876,-520"/>
<text text-anchor="middle" x="1523.2847" y="-904.8" font-family="Times,serif" font-size="24.00" fill="#000000">Platform namespace</text>
</g>
<!-- user -->
<g id="node1" class="node">
<title>user</title>
<ellipse fill="none" stroke="#000000" cx="160" cy="-1518" rx="144" ry="54"/>
<text text-anchor="middle" x="160" y="-1513.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">User</text>
</g>
<!-- ingress -->
<g id="node2" class="node">
<title>ingress</title>
<polygon fill="none" stroke="#000000" points="730.876,-1572 442.876,-1572 442.876,-1464 730.876,-1464 730.876,-1572"/>
<text text-anchor="middle" x="586.876" y="-1513.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Ingress</text>
</g>
<!-- user&#45;&gt;ingress -->
<g id="edge1" class="edge">
<title>user&#45;&gt;ingress</title>
<path fill="none" stroke="#000000" d="M304.2231,-1518C304.2231,-1518 432.6764,-1518 432.6764,-1518"/>
<polygon fill="#000000" stroke="#000000" points="432.6764,-1521.5001 442.6764,-1518 432.6764,-1514.5001 432.6764,-1521.5001"/>
<text text-anchor="start" x="340" y="-1562.8" font-family="Times,serif" font-size="14.00" fill="#000000">Cookie: </text>
<text text-anchor="start" x="340" y="-1548.8" font-family="Times,serif" font-size="14.00" fill="#000000"> userId </text>
<text text-anchor="start" x="340" y="-1534.8" font-family="Times,serif" font-size="14.00" fill="#000000"> userToken </text>
<text text-anchor="start" x="340" y="-1520.8" font-family="Times,serif" font-size="14.00" fill="#000000"> userDigest </text>
</g>
<!-- form -->
<g id="node3" class="node">
<title>form</title>
<polygon fill="none" stroke="#000000" points="1091.876,-1392 803.876,-1392 803.876,-1284 1091.876,-1284 1091.876,-1392"/>
<text text-anchor="middle" x="947.876" y="-1333.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Runner</text>
</g>
<!-- ingress&#45;&gt;form -->
<g id="edge2" class="edge">
<title>ingress&#45;&gt;form</title>
<path fill="none" stroke="#000000" d="M730.9154,-1518C831.8146,-1518 948.6934,-1518 948.6934,-1518 948.6934,-1518 948.6934,-1402.0059 948.6934,-1402.0059"/>
<polygon fill="#000000" stroke="#000000" points="952.1935,-1402.0059 948.6934,-1392.0059 945.1935,-1402.006 952.1935,-1402.0059"/>
</g>
<!-- data_api -->
<g id="node5" class="node">
<title>data_api</title>
<polygon fill="none" stroke="#000000" points="1452.876,-888 1164.876,-888 1164.876,-780 1452.876,-780 1452.876,-888"/>
<text text-anchor="middle" x="1308.876" y="-829.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Datastore API</text>
<text text-anchor="middle" x="1126.7417" y="-768.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Verify digest</text>
</g>
<!-- form&#45;&gt;data_api -->
<g id="edge3" class="edge">
<title>form&#45;&gt;data_api</title>
<path fill="none" stroke="#000000" d="M1091.9154,-1338C1192.8146,-1338 1309.6934,-1338 1309.6934,-1338 1309.6934,-1338 1309.6934,-898.4157 1309.6934,-898.4157"/>
<polygon fill="#000000" stroke="#000000" points="1313.1935,-898.4157 1309.6934,-888.4157 1306.1935,-898.4157 1313.1935,-898.4157"/>
<text text-anchor="start" x="1173.2207" y="-1215.8968" font-family="Times,serif" font-size="14.00" fill="#000000">serviceSlug </text>
<text text-anchor="start" x="1173.2207" y="-1201.8968" font-family="Times,serif" font-size="14.00" fill="#000000"> userId </text>
<text text-anchor="start" x="1173.2207" y="-1187.8968" font-family="Times,serif" font-size="14.00" fill="#000000"> payload: user data </text>
<text text-anchor="start" x="1173.2207" y="-1173.8968" font-family="Times,serif" font-size="14.00" fill="#000000"> AES&#45;encrypted </text>
<text text-anchor="start" x="1173.2207" y="-1159.8968" font-family="Times,serif" font-size="14.00" fill="#000000"> with userToken </text>
<text text-anchor="start" x="1173.2207" y="-1145.8968" font-family="Times,serif" font-size="14.00" fill="#000000"> digest: hash of payload </text>
<text text-anchor="start" x="1173.2207" y="-1131.8968" font-family="Times,serif" font-size="14.00" fill="#000000"> + service secret </text>
</g>
<!-- var -->
<g id="node4" class="node">
<title>var</title>
<polygon fill="none" stroke="#000000" points="712.876,-1386 442.876,-1386 442.876,-1290 712.876,-1290 712.876,-1284 730.876,-1338 712.876,-1392 712.876,-1386"/>
<text text-anchor="middle" x="586.876" y="-1340.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Env var</text>
<text text-anchor="middle" x="586.876" y="-1326.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">SERVICE_TOKEN</text>
</g>
<!-- var&#45;&gt;form -->
<g id="edge6" class="edge">
<title>var&#45;&gt;form</title>
<path fill="none" stroke="#000000" d="M731.1091,-1338C731.1091,-1338 793.872,-1338 793.872,-1338"/>
<polygon fill="#000000" stroke="#000000" points="793.8721,-1341.5001 803.872,-1338 793.872,-1334.5001 793.8721,-1341.5001"/>
</g>
<!-- token_cache -->
<g id="node6" class="node">
<title>token_cache</title>
<polygon fill="none" stroke="#000000" points="1452.876,-636 1164.876,-636 1164.876,-528 1452.876,-528 1452.876,-636"/>
<text text-anchor="middle" x="1308.876" y="-584.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Local cache</text>
<text text-anchor="middle" x="1308.876" y="-570.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">of tokens</text>
<text text-anchor="middle" x="1096.0005" y="-516.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Refresh on demand in</text>
<text text-anchor="middle" x="1096.0005" y="-502.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">event of cache miss</text>
<text text-anchor="middle" x="1096.0005" y="-488.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">or digest mismatch</text>
</g>
<!-- data_api&#45;&gt;token_cache -->
<g id="edge5" class="edge">
<title>data_api&#45;&gt;token_cache</title>
<path fill="none" stroke="#000000" d="M1309.6934,-779.9397C1309.6934,-779.9397 1309.6934,-646.4051 1309.6934,-646.4051"/>
<polygon fill="#000000" stroke="#000000" points="1313.1935,-646.4051 1309.6934,-636.4051 1306.1935,-646.4051 1313.1935,-646.4051"/>
</g>
<!-- data_db -->
<g id="node13" class="node">
<title>data_db</title>
<path fill="none" stroke="#000000" d="M1881.6934,-878.1818C1881.6934,-883.5993 1817.1503,-888 1737.6934,-888 1658.2365,-888 1593.6934,-883.5993 1593.6934,-878.1818 1593.6934,-878.1818 1593.6934,-789.8182 1593.6934,-789.8182 1593.6934,-784.4007 1658.2365,-780 1737.6934,-780 1817.1503,-780 1881.6934,-784.4007 1881.6934,-789.8182 1881.6934,-789.8182 1881.6934,-878.1818 1881.6934,-878.1818"/>
<path fill="none" stroke="#000000" d="M1881.6934,-878.1818C1881.6934,-872.7643 1817.1503,-868.3636 1737.6934,-868.3636 1658.2365,-868.3636 1593.6934,-872.7643 1593.6934,-878.1818"/>
<text text-anchor="middle" x="1737.6934" y="-829.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Datastore RDS</text>
</g>
<!-- data_api&#45;&gt;data_db -->
<g id="edge4" class="edge">
<title>data_api&#45;&gt;data_db</title>
<path fill="none" stroke="#000000" d="M1463.1574,-834C1463.1574,-834 1583.5507,-834 1583.5507,-834"/>
<polygon fill="#000000" stroke="#000000" points="1583.5507,-837.5 1593.5507,-834 1583.5507,-830.5 1583.5507,-837.5"/>
<polygon fill="#000000" stroke="#000000" points="1463.1575,-830.5 1453.1574,-834 1463.1574,-837.5 1463.1575,-830.5"/>
<text text-anchor="start" x="1488.876" y="-864.8" font-family="Times,serif" font-size="14.00" fill="#000000">serviceSlug </text>
<text text-anchor="start" x="1488.876" y="-850.8" font-family="Times,serif" font-size="14.00" fill="#000000"> userID </text>
<text text-anchor="start" x="1488.876" y="-836.8" font-family="Times,serif" font-size="14.00" fill="#000000"> payload </text>
</g>
<!-- secret -->
<g id="node7" class="node">
<title>secret</title>
<polygon fill="none" stroke="#000000" points="730.876,-1140 442.876,-1140 442.876,-1032 730.876,-1032 730.876,-1140"/>
<text text-anchor="middle" x="586.876" y="-1088.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Kubernetes secret</text>
<text text-anchor="middle" x="586.876" y="-1074.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">{service}&#45;token (PSK)</text>
</g>
<!-- secret&#45;&gt;var -->
<g id="edge7" class="edge">
<title>secret&#45;&gt;var</title>
<path fill="none" stroke="#000000" d="M587.6934,-1140.0603C587.6934,-1140.0603 587.6934,-1273.5949 587.6934,-1273.5949"/>
<polygon fill="#000000" stroke="#000000" points="584.1935,-1273.5949 587.6934,-1283.5949 591.1935,-1273.5949 584.1935,-1273.5949"/>
</g>
<!-- secret&#45;&gt;token_cache -->
<g id="edge8" class="edge">
<title>secret&#45;&gt;token_cache</title>
<path fill="none" stroke="#000000" d="M741.1023,-1086C741.1023,-1086 767.6934,-1086 767.6934,-1086 767.6934,-1086 767.6934,-582 767.6934,-582 767.6934,-582 1154.5599,-582 1154.5599,-582"/>
<polygon fill="#000000" stroke="#000000" points="741.1023,-1082.5001 731.1023,-1086 741.1022,-1089.5001 741.1023,-1082.5001"/>
<polygon fill="#000000" stroke="#000000" points="1154.5599,-585.5001 1164.5599,-582 1154.5598,-578.5001 1154.5599,-585.5001"/>
</g>
<!-- publisher_workers -->
<g id="node8" class="node">
<title>publisher_workers</title>
<polygon fill="none" stroke="#000000" points="730.876,-888 442.876,-888 442.876,-780 730.876,-780 730.876,-888"/>
<text text-anchor="middle" x="586.876" y="-829.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Workers</text>
</g>
<!-- publisher_workers&#45;&gt;secret -->
<g id="edge9" class="edge">
<title>publisher_workers&#45;&gt;secret</title>
<path fill="none" stroke="#000000" d="M587.6934,-888.0603C587.6934,-888.0603 587.6934,-1021.5949 587.6934,-1021.5949"/>
<polygon fill="#000000" stroke="#000000" points="584.1935,-1021.5949 587.6934,-1031.5949 591.1935,-1021.5949 584.1935,-1021.5949"/>
</g>
<!-- publisher_db -->
<g id="node9" class="node">
<title>publisher_db</title>
<path fill="none" stroke="#000000" d="M730.876,-626.1818C730.876,-631.5993 666.3329,-636 586.876,-636 507.4191,-636 442.876,-631.5993 442.876,-626.1818 442.876,-626.1818 442.876,-537.8182 442.876,-537.8182 442.876,-532.4007 507.4191,-528 586.876,-528 666.3329,-528 730.876,-532.4007 730.876,-537.8182 730.876,-537.8182 730.876,-626.1818 730.876,-626.1818"/>
<path fill="none" stroke="#000000" d="M730.876,-626.1818C730.876,-620.7643 666.3329,-616.3636 586.876,-616.3636 507.4191,-616.3636 442.876,-620.7643 442.876,-626.1818"/>
<text text-anchor="middle" x="586.876" y="-577.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Publisher DB</text>
</g>
<!-- publisher_db&#45;&gt;publisher_workers -->
<g id="edge10" class="edge">
<title>publisher_db&#45;&gt;publisher_workers</title>
<path fill="none" stroke="#000000" d="M587.6934,-646.0603C587.6934,-646.0603 587.6934,-769.5949 587.6934,-769.5949"/>
<polygon fill="#000000" stroke="#000000" points="584.1934,-769.5949 587.6934,-779.5949 591.1934,-769.5949 584.1934,-769.5949"/>
<polygon fill="#000000" stroke="#000000" points="591.1934,-646.0603 587.6934,-636.0603 584.1934,-646.0603 591.1934,-646.0603"/>
</g>
<!-- publisher_web -->
<g id="node10" class="node">
<title>publisher_web</title>
<polygon fill="none" stroke="#000000" points="730.876,-384 442.876,-384 442.876,-276 730.876,-276 730.876,-384"/>
<text text-anchor="middle" x="586.876" y="-325.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Web app</text>
</g>
<!-- publisher_web&#45;&gt;publisher_db -->
<g id="edge11" class="edge">
<title>publisher_web&#45;&gt;publisher_db</title>
<path fill="none" stroke="#000000" d="M587.6934,-384.0603C587.6934,-384.0603 587.6934,-517.5949 587.6934,-517.5949"/>
<polygon fill="#000000" stroke="#000000" points="584.1935,-517.5949 587.6934,-527.5949 591.1935,-517.5949 584.1935,-517.5949"/>
</g>
<!-- publisher_ingress -->
<g id="node11" class="node">
<title>publisher_ingress</title>
<polygon fill="none" stroke="#000000" points="730.876,-132 442.876,-132 442.876,-24 730.876,-24 730.876,-132"/>
<text text-anchor="middle" x="586.876" y="-73.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Ingress</text>
</g>
<!-- publisher_ingress&#45;&gt;publisher_web -->
<g id="edge12" class="edge">
<title>publisher_ingress&#45;&gt;publisher_web</title>
<path fill="none" stroke="#000000" d="M587.6934,-132.0603C587.6934,-132.0603 587.6934,-265.5949 587.6934,-265.5949"/>
<polygon fill="#000000" stroke="#000000" points="584.1935,-265.5949 587.6934,-275.5949 591.1935,-265.5949 584.1935,-265.5949"/>
</g>
<!-- developer -->
<g id="node12" class="node">
<title>developer</title>
<ellipse fill="none" stroke="#000000" cx="160" cy="-78" rx="144" ry="54"/>
<text text-anchor="middle" x="160" y="-73.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">Form developer</text>
</g>
<!-- developer&#45;&gt;publisher_ingress -->
<g id="edge13" class="edge">
<title>developer&#45;&gt;publisher_ingress</title>
<path fill="none" stroke="#000000" d="M304.2231,-78C304.2231,-78 432.6764,-78 432.6764,-78"/>
<polygon fill="#000000" stroke="#000000" points="432.6764,-81.5001 442.6764,-78 432.6764,-74.5001 432.6764,-81.5001"/>
</g>
</g>
</svg>
